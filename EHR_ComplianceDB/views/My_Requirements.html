<html>
<head>
    <script type="text/javascript">

        Ext.onReady(function()
        {

            var userName = LABKEY.Security.currentUser.email;

            //we find this employee's info
            var employeeRecord = new LABKEY.ext.Store({
                schemaName: 'lists',
                queryName: 'Employees',
                containerPath: 'WNPRC/WNPRC_Units/Animal_Services/Compliance_Training/Private/EmployeeDB/',
                //need to update once we have real unique IDs in the tables
                filterArray: [LABKEY.Filter.create('Email', userName, LABKEY.Filter.Types.EQUAL)
                ]
            });

            employeeRecord.on('load', loadRequirements);
            employeeRecord.load();

            function loadRequirements()
            {
                if (employeeRecord.data.items.length < 1){alert('No Records Found for user ID: '+userName+'. Contact Sandra Boehm if this is an error.');return;}

                employeeRecord = employeeRecord.data.items[0];

                //we display a list of all requirements for this person
                var requirementStore = new LABKEY.ext.Store({
                    schemaName: 'lists',
                    queryName: 'ComplianceRecentTests',
                    containerPath: 'WNPRC/WNPRC_Units/Animal_Services/Compliance_Training/Private/EmployeeDB/',
                    //TODO: need to update once we have real unique IDs in the tables
                    columns: 'Id,requirementName,requirementName/type,ExpirePeriod,MostRecentDate,MonthsUntilRenewal',
                    filterArray: [LABKEY.Filter.create('Id', employeeRecord.get('Id'), LABKEY.Filter.Types.EQUAL)
                    ],
                    sort: 'requirementName/type,RequirementName'
                });

                var requirementGrid = new LABKEY.ext.EditorGridPanel({
                    store: requirementStore
                    ,applyTo: 'myRequirementsDiv'
                    ,width: 1200
                    ,autoHeight: true
                    ,title: 'My Requirements'
                    ,editable: false
                    ,stripeRows: true
                    ,disableSelection: true
                });
                requirementGrid.on("columnmodelcustomize", customizeColumnModel);

                function customizeColumnModel(colModel, index)
                    {
                        //apparently cannot do this prior to render
                        index['Id']['width'] = 60;
                        index['requirementName/type']['width'] = 60;
                        index['requirementName/type']['header'] = 'Type';
                        index['requirementName']['width'] = 200;
                        index['ExpirePeriod']['width'] = 100;
                        index['MostRecentDate']['width'] = 90;
                        index['MonthsUntilRenewal']['width'] = 90;

                    }
            }

        });


    </script>
</head>

<body>
<p>

<div id='myRequirementsDiv'></div>


</body>
</html>