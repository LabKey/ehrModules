<html>
<head>
<script type="text/javascript">

LABKEY.requiresScript("/ehr/utilities.js");

Ext.onReady(function(){

    var dataset = LABKEY.ActionURL.getParameter('dataset');
    if (!dataset){alert('Must Provide Dataset Name'); return false;}

    new LABKEY.QueryWebPart({
         title: dataset,
         //frame: 'none',
         schemaName: 'study',
         queryName: dataset,
         allowChooseQuery: false,
         allowChooseView: true,
         showInsertNewButton: false,
         showDeleteButton: false,
         showDetailsColumn: true,
         showUpdateColumn: false,
         buttonBarPosition: 'top',
         showRecordSelectors: true,
         errorCallback: EHR.UTILITIES.onError,
         scope: this,
         buttonBar: {
            includeStandardButtons: true,
            items:[
              LABKEY.QueryWebPart.standardButtons.views,
              LABKEY.QueryWebPart.standardButtons.exportRows,
              LABKEY.QueryWebPart.standardButtons.print,
              LABKEY.QueryWebPart.standardButtons.pageSize,
              {text: 'Animal History', handler: historyHandler}
            ]
        }
     }).render('theGrid');


    function historyHandler(dataRegion)
    {
        var checked = dataRegion.getChecked();

        var sql = 'SELECT DISTINCT Id FROM study.studydata WHERE LSID IN "' + checked.join(',') + '"'

        LABKEY.Query.executeSql({
             schemaName: 'study',
             sql: sql,
             successCallback: changeLocation
             });

    }

    function changeLocation(data){
        alert(data)
    }

});

</script>
</head>

<body>


<div id='theGrid'></div>


</body>
</html>
