<html>
<script type="text/javascript">

LABKEY.requiresScript("/ehr/navMenu.js");


Ext.onReady(createNavMenu);

function createNavMenu()
{

    var config = {displayField: 'Label', headerField: 'Category', target: 'ehrDatasets'};
    
    LABKEY.Query.selectRows({
        schemaName: 'study',
        queryName: 'DataSets',
        successCallback: onSuccess,
        scope: this,
        errorCallback: EHR.utils.onError,
        sort: config.headerField+','+config.displayField,
        filterArray: config.filterArray
    });

    function onSuccess(data){
        var menuCfg = {
            renderTo: config.target,
            sections: new Array(),
            columns: 3,
            colWidth: 400,
            renderer: function(item){
                return {
                    html: '<div style="float:left;width:180px;">'+item.name+':</div> [<a href="<%=contextPath%>/ehr<%=containerPath%>/searchPanel.view?schemaName=study&queryName='+item.data.Label+'">Search</a>] [<a href="<%=contextPath%>/ehr<%=containerPath%>/executeQuery.view?schemaName=study&query.queryName='+item.data.Label+'">View All Records</a>]',
                    style: 'padding-left:5px;padding-bottom:8px'
                };
            }
        }

        var sections = {};
        var section;
        for (var i=0;i<data.rows.length;i++){
            var row = data.rows[i];
            if(!row.ShowByDefault){
                continue;
            }

            if (!sections[row[config.headerField]]){
                section = {header: row[config.headerField], items: []};
                sections[row[config.headerField]] = section;

                menuCfg.sections.push(section);
            }
            else
                section = sections[row[config.headerField]];

            section.items.push({name: row[config.displayField], data: row})

        }

        new EHR.utils.navMenu(menuCfg);
    }



}

</script>
<body>

<div id="ehrDatasets"></div>

</body>
</html>