<script type="text/javascript">
    LABKEY.requiresScript("/ehr/ehrDetailsPanel.js");
</script>
<script type="text/javascript">

Ext.onReady(function (){
    if (!LABKEY.ActionURL.getParameter('objectid')){alert('Must Provide LSID'); return false;}

    if (LABKEY.ActionURL.getParameter('formtype')){
        window.location = LABKEY.ActionURL.buildURL('ehr', 'taskDetails', null, {
            formtype: LABKEY.ActionURL.getParameter('formtype'),
            taskid: LABKEY.ActionURL.getParameter('taskid')
        });
    }

    var webpart = <%=webpartContext%>;
    var domSpec = [{
        tag: 'div',
        style: 'padding-bottom: 10px;',
        id: 'encounterDetails_' + webpart.wrapperDivId
    },{
        tag: 'div',
        id: 'childTables_' + webpart.wrapperDivId
    }]

    var el = Ext.get(webpart.wrapperDivId);
    Ext.DomHelper.append(el, domSpec);

    var filterArray = [LABKEY.Filter.create('objectid', LABKEY.ActionURL.getParameter('objectid'), LABKEY.Filter.Types.EQUAL)];

    new EHR.ext.DetailsView({
        schemaName: 'study',
        queryName: 'encounters',
        title: 'Encounter Details:',
        renderTo: 'encounterDetails_' + webpart.wrapperDivId,
        filterArray: filterArray
    });


    new LABKEY.QueryWebPart({
        title: 'Records',
        schemaName: 'study',
        queryName: 'StudyData',
        allowChooseQuery: false,
        allowChooseView: true,
        showInsertNewButton: false,
        showDeleteButton: false,
        showDetailsColumn: true,
        showUpdateColumn: false,
        showRecordSelectors: true,
        buttonBarPosition: 'top',
        timeout: 0,
        filterArray: [LABKEY.Filter.create('parentId', LABKEY.ActionURL.getParameter('objectid'), LABKEY.Filter.Types.EQUAL)],
        sort: '-Date',
        scope: this,
        failure: EHR.Utils.onError
     }).render('childTables_' + webpart.wrapperDivId);

});

</script>