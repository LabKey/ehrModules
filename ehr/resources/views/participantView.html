<script type="text/javascript">
    Ext4.onReady(function (){
        var webpart = <%=webpartContext%>;
        var ctx = EHR.Utils.getEHRContext(webpart.wrapperDivId);
        if(!ctx)
            return;

        /* get the participant id from the request URL: this parameter is required. */
        var participantId = LABKEY.ActionURL.getParameter('participantId');

        if (!participantId){
            alert('Must Provide Id');
            return;
        }

        var title = 'Animal Details: ' + participantId;
        document.title = title;
        LABKEY.Utils.setWebpartTitle(title, webpart.id);

        Ext4.create('EHR.panel.ParticipantDetailsPanel', {
            participantId: participantId,
            defaultReport: ctx.DefaultAnimalHistoryReport,
            defaultTab: 'General',
            autoLoadDefaultTab: true,
            idNormalizer: function(subjects)
            {
                // Preserve the ID as passed on the URL
                return [subjects];
            }
        }).render(webpart.wrapperDivId);
    });
</script>